/*! @wireapp/store-engine v1.0.13 */
var StoreEngine=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s=0)}([function(e,t,r){"use strict";var n=r(9),o=r(1),i=r(20);e.exports={FileEngine:n.FileEngine,FileSystemEngine:n.FileSystemEngine,IndexedDBEngine:n.IndexedDBEngine,LocalStorageEngine:n.LocalStorageEngine,MemoryEngine:n.MemoryEngine,Store:{ExpiredBundle:i.ExpiredBundle,RecordAlreadyExistsError:o.RecordAlreadyExistsError,TransientBundle:i.TransientBundle,TransientStore:i.TransientStore},error:{PathValidationError:o.PathValidationError,RecordAlreadyExistsError:o.RecordAlreadyExistsError,RecordNotFoundError:o.RecordNotFoundError,RecordTypeError:o.RecordTypeError,UnsupportedError:o.UnsupportedError}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(13);t.PathValidationError=n.default;var o=r(3);t.RecordAlreadyExistsError=o.default;var i=r(4);t.RecordNotFoundError=i.default;var s=r(5);t.RecordTypeError=s.default;var u=r(14);t.UnsupportedError=u.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBrowser=function(){return"undefined"!=typeof window}},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(r){var n=e.call(this,r)||this;return n.message=r,Object.setPrototypeOf(n,t.prototype),n.code=1,n.message=r,n.name=n.constructor.name,n.stack=(new Error).stack,n}return n(t,e),t}(Error);t.default=o},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(r){var n=e.call(this,r)||this;return n.message=r,Object.setPrototypeOf(n,t.prototype),n.code=2,n.message=r,n.name=n.constructor.name,n.stack=(new Error).stack,n}return n(t,e),t}(Error);t.default=o},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(r){var n=e.call(this,r)||this;return n.message=r,Object.setPrototypeOf(n,t.prototype),n.code=3,n.message=r,n.name=n.constructor.name,n.stack=(new Error).stack,n}return n(t,e),t}(Error);t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(){this.expires=0}}();t.default=n},function(e,t){e.exports=Dexie},function(e,t,r){
/*! bro-fs v0.3.0 */
!function(t,r){e.exports=r()}(0,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=4)}([function(e,t,r){"use strict";t.promiseCall=function(e,t){if(!e)throw new Error("Can't call promisified method '"+t+"' of "+e);var r=[].slice.call(arguments,2);return new Promise(function(n,o){var i=function(e){return function(){for(var t=arguments.length,r=[];t--;)r[t]=arguments[t];0===r.length?e():1===r.length?e(r[0]):e(r)}}(n),s=function(e,t,r,n){return function(o){var i="";try{i=JSON.stringify(r)}catch(e){i=r.join(", ")}e.name=o.name,e.message=o.message+" Call: "+t+"("+i+")",n(e)}}(new Error,t,r,o),u=r.concat([i,s]);return e[t].apply(e,u)})},t.parsePath=function(e){var r=t.splitPath(e),n=r.pop();return{dirPath:r.join("/"),fileName:n}},t.splitPath=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if((e=e.replace(/^\.\//,"")).length>1&&e.endsWith("/"))throw new Error("Path can not end with '/'");return e.split("/").filter(Boolean)}},function(e,t,r){"use strict";t.isNotFoundError=function(e){return e&&"NotFoundError"===e.name},t.isTypeMismatchError=function(e){return e&&"TypeMismatchError"===e.name}},function(e,t,r){"use strict";var n=null,o=null;t.get=function(){if(n)return n;throw new Error("Filesystem not initialized.")},t.set=function(e,t){n=e,o=t},t.getType=function(){return o}},function(e,t,r){"use strict";var n=r(0),o=r(1),i=r(2);t.get=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e&&"string"!=typeof e?e.isDirectory?Promise.resolve(e):Promise.reject(new DOMError("TypeMismatchError","Expected directory but got file")):n.splitPath(e).reduce(function(e,r){return e.then(function(e){var i=function(e,t){return n.promiseCall(e,"getDirectory",t,{create:!1})}(e,r);return t.create&&(i=i.catch(function(t){return o.isNotFoundError(t)?function(e,t){return n.promiseCall(e,"getDirectory",t,{create:!0,exclusive:!1})}(e,r):Promise.reject(t)})),i})},Promise.resolve(i.get()))},t.read=function(e){return n.promiseCall(e.createReader(),"readEntries")},t.readDeep=function(e){return t.read(e).then(function(e){var r=e.map(function(e){return e.isDirectory?t.readDeep(e).then(function(t){return Object.assign(e,{children:t})}):Promise.resolve(e)});return Promise.all(r)})}},function(e,t,r){"use strict";var n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var s,u=e[Symbol.iterator]();!(n=(s=u.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{!n&&u.return&&u.return()}finally{if(o)throw i}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=r(0),i=r(1),s=r(2),u=r(5),a=r(3),c=r(6),l=r(7);function f(e,r,i,s){if(e===r)return Promise.resolve();var u=o.parsePath(r),c=u.dirPath,l=u.fileName;return Promise.all([t.getEntry(e),a.get(c,s)]).then(function(e){var t=n(e,2),r=t[0],s=t[1];return o.promiseCall(r,i,s,l)})}t.isSupported=function(){return Boolean(window.webkitRequestFileSystem)},t.init=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.hasOwnProperty("type")?e.type:window.PERSISTENT,r=e.bytes||1048576;!function(e){if(e!==window.PERSISTENT&&e!==window.TEMPORARY)throw new Error("Unknown storage type "+e)}(t);var n=t===window.PERSISTENT&&(!e.hasOwnProperty("requestQuota")||e.requestQuota);return Promise.resolve().then(function(){return n?l.requestPersistent(r):r}).then(function(e){return o.promiseCall(window,"webkitRequestFileSystem",t,e)}).then(function(e){return s.set(e.root,t),e})},t.usage=function(){return l.usage(s.getType())},t.getRoot=function(){return s.get()},t.readFile=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return u.get(e).then(function(e){return u.read(e,t)})},t.writeFile=function(e,t){return u.get(e,{create:!0,overwrite:!0}).then(function(e){return u.write(e,t,{append:!1})})},t.appendFile=function(e,t){return u.get(e,{create:!0,overwrite:!1}).then(function(e){return u.write(e,t,{append:!0})})},t.unlink=function(e){return u.get(e).then(function(e){return o.promiseCall(e,"remove")},function(e){return i.isNotFoundError(e)?Promise.resolve(!1):Promise.reject(e)})},t.rename=function(e,t){return f(e,t,"moveTo",arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})},t.copy=function(e,t){return f(e,t,"copyTo",arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})},t.rmdir=function(e){return a.get(e).then(function(e){return e===s.get()?Promise.reject("Can not remove root. Use clear() to clear fs."):o.promiseCall(e,"removeRecursively")},function(e){return i.isNotFoundError(e)?Promise.resolve(!1):Promise.reject(e)})},t.mkdir=function(e){return a.get(e,{create:!0})},t.exists=function(e){return t.getEntry(e).then(function(){return!0},function(e){return!i.isNotFoundError(e)&&Promise.reject(e)})},t.stat=function(e){return t.getEntry(e).then(function(e){return c.get(e)})},t.readdir=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a.get(e).then(function(e){return t.deep?a.readDeep(e):a.read(e)})},t.clear=function(){return t.readdir("/").then(function(e){var t=e.map(function(e){return e.isDirectory?o.promiseCall(e,"removeRecursively"):o.promiseCall(e,"remove")});return Promise.all(t)})},t.getUrl=function(e){return t.getEntry(e).then(function(e){return e.toURL()})},t.getEntry=function(e){return u.get(e).catch(function(t){return i.isTypeMismatchError(t)?a.get(e):Promise.reject(t)})}},function(e,t,r){"use strict";var n=r(0),o=r(1),i=r(3);function s(e,t){return n.promiseCall(e,"getFile",t,{create:!0,exclusive:!1})}function u(e,t){return n.promiseCall(e,"getFile",t,{create:!1})}t.get=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e&&"string"!=typeof e)return e.isFile?Promise.resolve(e):Promise.reject(new DOMError("TypeMismatchError","Expected file but got directory"));var r=n.parsePath(e),a=r.dirPath,c=r.fileName;return Promise.resolve().then(function(){return i.get(a,t)}).then(function(e){return t.create?t.overwrite?s(e,c):u(e,c).catch(function(t){return o.isNotFoundError(t)?s(e,c):Promise.reject(t)}):u(e,c)})},t.write=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.promiseCall(e,"createWriter").then(function(e){return new Promise(function(n,o){if(r.append)e.seek(e.length),e.onwriteend=n;else{var i=!1;e.onwriteend=function(){i?n():(i=!0,this.truncate(this.position))}}e.onerror=o;var s=new Blob([t],{type:function(e){return"string"==typeof e?"text/plain":"application/octet-binary"}(t)});e.write(s)})}).then(function(){return e})},t.read=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n.promiseCall(e,"file").then(function(e){return new Promise(function(r,n){var o=new FileReader;o.onload=function(){return r(o.result)},o.onerror=function(){return n(o.error)},function(e,t,r){switch(e){case"ArrayBuffer":return t.readAsArrayBuffer(r);case"BinaryString":return t.readAsBinaryString(r);case"DataURL":return t.readAsDataURL(r);case"Text":default:t.readAsText(r)}}(t.type,o,e)})})}},function(e,t,r){"use strict";var n=r(0);t.get=function(e){return n.promiseCall(e,"getMetadata").then(function(t){return{isFile:e.isFile,isDirectory:e.isDirectory,name:e.name,fullPath:e.fullPath,modificationTime:t.modificationTime,size:t.size}})}},function(e,t,r){"use strict";var n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var s,u=e[Symbol.iterator]();!(n=(s=u.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{!n&&u.return&&u.return()}finally{if(o)throw i}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=r(0);function i(e){return e===window.PERSISTENT?navigator.webkitPersistentStorage:navigator.webkitTemporaryStorage}t.requestPersistent=function(e){var t=i(window.PERSISTENT);return o.promiseCall(t,"requestQuota",e).then(function(t){return t>0?t:Promise.reject("Quota not granted (requested: "+e+", granted: "+t+")")})},t.usage=function(e){var t=i(e);return o.promiseCall(t,"queryUsageAndQuota").then(function(e){var t=n(e,2);return{usedBytes:t[0],grantedBytes:t[1]}})}}])})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(10);t.FileEngine=n.default;var o=r(15);t.FileSystemEngine=o.default;var i=r(16);t.IndexedDBEngine=i.default;var s=r(18);t.LocalStorageEngine=s.default;var u=r(19);t.MemoryEngine=u.default},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{a(n.next(e))}catch(e){i(e)}}function u(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(s,u)}a((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(11),u=r(12),a=r(2),c=r(1),l=function(){function e(e){void 0===e&&(e="./"),this.baseDirectory=e,this.storeName="",this.options={fileExtension:".dat"}}return e.prototype.isSupported=function(){return o(this,void 0,void 0,function(){var e;return i(this,function(t){if(a.isBrowser())throw e="Node.js File System Module is not available on your platform.",new c.UnsupportedError(e);return[2]})})},e.prototype.init=function(t,r){return void 0===t&&(t=""),o(this,void 0,void 0,function(){return i(this,function(o){switch(o.label){case 0:return[4,this.isSupported()];case 1:return o.sent(),e.enforcePathRestrictions(this.baseDirectory,t),this.storeName=e.path.resolve(this.baseDirectory,t),this.options=n({},this.options,r),[2,Promise.resolve(t)]}})})},e.prototype.purge=function(){return s.remove(this.storeName)},e.enforcePathRestrictions=function(t,r){var n=e.path.resolve(t),o=e.path.parse(n);if(o.root===o.dir&&""===o.base){var i='"'+n+'" cannot be the root of the filesystem.';throw new c.PathValidationError(i)}var s=e.path.resolve(n,r);if(!1===s.startsWith(n)){i='Path traversal has been detected. Allowed path was "'+n+'" but tested path "'+r+'" attempted to reach "'+s+'"';throw new c.PathValidationError(i)}return s},e.prototype.resolvePath=function(t,r){var n=this;return void 0===r&&(r=""),new Promise(function(o,i){var s=e.enforcePathRestrictions(n.storeName,t);return o(e.enforcePathRestrictions(s,r?""+r+n.options.fileExtension:""))})},e.prototype.create=function(e,t,r){var n=this;return new Promise(function(o,i){if(r)n.resolvePath(e,t).then(function(n){if("object"==typeof r)try{r=JSON.stringify(r)}catch(e){r=r.toString()}s.writeFile(n,r,{flag:"wx"},function(u){if(u)if("ENOENT"===u.code)s.outputFile(n,r).then(function(){return o(t)}).catch(function(e){return i(e)});else if("EEXIST"===u.code){var a='Record "'+t+'" already exists in "'+e+'". You need to delete the record first if you want to overwrite it.';i(new c.RecordAlreadyExistsError(a))}else i(u);else o(t)})}).catch(i);else{var u='Record "'+t+'" cannot be saved in "'+e+'" because it\'s "undefined" or "null".';i(new c.RecordTypeError(u))}})},e.prototype.delete=function(e,t){return this.resolvePath(e,t).then(function(e){return s.remove(e).then(function(){return t})})},e.prototype.deleteAll=function(e){return this.resolvePath(e).then(function(e){return s.remove(e).then(function(){return!0}).catch(function(){return!1})})},e.prototype.read=function(e,t){return this.resolvePath(e,t).then(function(r){return new Promise(function(n,o){s.readFile(r,{encoding:"utf8",flag:"r"},function(r,i){if(r)if("ENOENT"===r.code){var s='Record "'+t+'" in "'+e+'" could not be found.';o(new c.RecordNotFoundError(s))}else o(r);else{try{i=JSON.parse(i)}catch(r){}n(i)}})})})},e.prototype.readAll=function(t){var r=this;return this.resolvePath(t).then(function(n){return new Promise(function(o,i){s.readdir(n,function(n,s){if(n)return i(n);var u=s.map(function(t){return e.path.basename(t,e.path.extname(t))}).map(function(e){return r.read(t,e)});return Promise.all(u).then(function(e){return o(e)})})})})},e.prototype.readAllPrimaryKeys=function(t){return this.resolvePath(t).then(function(t){return new Promise(function(r){s.readdir(t,function(t,n){if(t){if("ENOENT"!==t.code)throw t;r([])}else{var o=n.map(function(t){return e.path.parse(t).name});r(o)}})})})},e.prototype.append=function(e,t,r){var n=this;return this.resolvePath(e,t).then(function(o){return n.read(e,t).then(function(e){if("string"!=typeof e){var n='Cannot append text to record "'+t+"\" because it's not a string.";throw new c.RecordTypeError(n)}return e+=r}).then(function(e){return s.outputFile(o,e)}).then(function(){return t})})},e.prototype.update=function(e,t,r){var o=this;return this.resolvePath(e,t).then(function(i){return o.read(e,t).then(function(e){"string"==typeof e&&(e=JSON.parse(e));var t=n({},e,r);return JSON.stringify(t)}).then(function(e){return s.outputFile(i,e)}).then(function(){return t})})},e.prototype.updateOrCreate=function(e,t,r){var n=this;return this.update(e,t,r).catch(function(o){if(o instanceof c.RecordNotFoundError)return n.create(e,t,r);throw o}).then(function(){return t})},e.path=u,e}();t.default=l},function(e,t){e.exports={}},function(e,t){},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(r){var n=e.call(this,r)||this;return n.message=r,Object.setPrototypeOf(n,t.prototype),n.message=r,n.name=n.constructor.name,n.stack=(new Error).stack,n}return n(t,e),t}(Error);t.default=o},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(r){var n=e.call(this,r)||this;return n.message=r,Object.setPrototypeOf(n,t.prototype),n.code=4,n.message=r,n.name=n.constructor.name,n.stack=(new Error).stack,n}return n(t,e),t}(Error);t.default=o},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{a(n.next(e))}catch(e){i(e)}}function u(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(s,u)}a((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(8),u=r(2),a=r(1),c=10485760,l=function(){function e(){this.storeName="",this.config={fileExtension:".dat",size:c,type:"undefined"==typeof window?0:window.TEMPORARY}}return e.prototype.isSupported=function(){return o(this,void 0,void 0,function(){var e;return i(this,function(t){if(!u.isBrowser()||!s.isSupported())throw e="File and Directory Entries API is not available on your platform.",new a.UnsupportedError(e);return[2]})})},e.prototype.init=function(e,t){return void 0===e&&(e=""),o(this,void 0,void 0,function(){var r;return i(this,function(o){switch(o.label){case 0:return[4,this.isSupported()];case 1:return o.sent(),this.config=n({},this.config,t),this.storeName=e,[4,s.init({type:this.config.type,bytes:this.config.size})];case 2:return r=o.sent(),[4,s.mkdir(this.storeName)];case 3:return o.sent(),[2,r]}})})},e.prototype.createDirectoryPath=function(e){return this.storeName+"/"+e},e.prototype.createFilePath=function(e,t){return this.createDirectoryPath(e)+"/"+t+this.config.fileExtension},e.prototype.append=function(e,t,r){return o(this,void 0,void 0,function(){var n,o,u;return i(this,function(i){switch(i.label){case 0:return n=this.createFilePath(e,t),[4,this.read(e,t)];case 1:return"string"!=typeof(o=i.sent())?[3,3]:[4,s.writeFile(n,o+r)];case 2:return i.sent(),[2,t];case 3:throw u='Cannot append text to record "'+t+"\" because it's not a string.",new a.RecordTypeError(u)}})})},e.prototype.create=function(e,t,r){return o(this,void 0,void 0,function(){var n,o,u;return i(this,function(i){switch(i.label){case 0:if(!r)throw o='Record "'+t+'" cannot be saved in "'+e+'" because it\'s "undefined" or "null".',new a.RecordTypeError(o);return n=this.createFilePath(e,t),[4,s.exists(n)];case 1:if(!i.sent())return[3,2];throw o='Record "'+t+'" already exists in "'+e+'". You need to delete the record first if you want to overwrite it.',new a.RecordAlreadyExistsError(o);case 2:u=void 0;try{u=JSON.stringify(r)}catch(e){u=r.toString()}return[4,s.writeFile(n,u)];case 3:return i.sent(),[2,t]}})})},e.prototype.delete=function(e,t){return o(this,void 0,void 0,function(){var r;return i(this,function(n){switch(n.label){case 0:return r=this.createFilePath(e,t),[4,s.unlink(r)];case 1:return n.sent(),[2,t]}})})},e.prototype.deleteAll=function(e){return o(this,void 0,void 0,function(){var t,r,n,o,s;return i(this,function(i){switch(i.label){case 0:return[4,this.readAllPrimaryKeys(e)];case 1:for(t=i.sent(),r=[],n=0,o=t;n<o.length;n++)s=o[n],r.push(this.delete(e,s));i.label=2;case 2:return i.trys.push([2,4,,5]),[4,Promise.all(r)];case 3:return i.sent(),[2,!0];case 4:return i.sent(),[2,!1];case 5:return[2]}})})},e.prototype.read=function(e,t){return o(this,void 0,void 0,function(){var r,n,o;return i(this,function(i){switch(i.label){case 0:r=this.createFilePath(e,t),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,s.readFile(r,{type:"Text"})];case 2:return n=i.sent(),[3,4];case 3:throw i.sent(),o='Record "'+t+'" in "'+e+'" could not be found.',new a.RecordNotFoundError(o);case 4:try{return[2,JSON.parse(n)]}catch(e){return[2,n]}return[2]}})})},e.prototype.readAll=function(e){return o(this,void 0,void 0,function(){var t,r,n,o,s;return i(this,function(i){switch(i.label){case 0:return[4,this.readAllPrimaryKeys(e)];case 1:for(t=i.sent(),r=[],n=0,o=t;n<o.length;n++)s=o[n],r.push(this.read(e,s));return[2,Promise.all(r)]}})})},e.prototype.readAllPrimaryKeys=function(e){return o(this,void 0,void 0,function(){var t,r,n,o,u,a,c,l;return i(this,function(i){switch(i.label){case 0:t=this.createDirectoryPath(e),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,s.readdir(t,{deep:!0})];case 2:return r=i.sent(),[3,4];case 3:return i.sent(),r=[],[3,4];case 4:for(n=r.map(function(e){return e.name}),o=[],u=0,a=n.sort();u<a.length;u++)c=a[u],l=c.substr(0,c.indexOf(".")),o.push(l);return[2,o]}})})},e.prototype.update=function(e,t,r){var o=this.createFilePath(e,t);return this.read(e,t).then(function(e){"string"==typeof e&&(e=JSON.parse(e));var t=n({},e,r);return JSON.stringify(t)}).then(function(e){return s.writeFile(o,e)}).then(function(){return t})},e.prototype.purge=function(){return o(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return[4,s.rmdir(this.storeName)];case 1:return e.sent(),[2]}})})},e.prototype.updateOrCreate=function(e,t,r){var n=this;return this.update(e,t,r).catch(function(o){if(o instanceof a.RecordNotFoundError)return n.create(e,t,r);throw o}).then(function(){return t})},e}();t.default=l},function(e,t,r){"use strict";(function(e){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{a(n.next(e))}catch(e){i(e)}}function u(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(s,u)}a((n=n.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(7),s=r(1),u=r(3),a=r(4),c=r(5),l=function(){function t(){this.storeName=""}return t.prototype.canUseIndexedDB=function(){var t=void 0===e?window:e;return"indexedDB"in t?new Promise(function(e,r){var n=t.indexedDB.open("test");n.onerror=function(e){return r(e)},n.onsuccess=function(){n.result.close();var o=t.indexedDB.deleteDatabase("test");o.onerror=function(e){return r(e)},o.onsuccess=function(){return e()}}}):Promise.reject(new Error("Could not find indexedDB in global scope"))},t.prototype.isSupported=function(){return n(this,void 0,void 0,function(){var e,t;return o(this,function(r){switch(r.label){case 0:e="IndexedDB is not available on your platform.",t=new s.UnsupportedError(e),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.canUseIndexedDB()];case 2:return r.sent(),[3,4];case 3:throw r.sent(),t;case 4:return[2]}})})},t.prototype.init=function(e){return n(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,this.isSupported()];case 1:return t.sent(),this.db=new i.default(e),this.storeName=this.db.name,[2,this.db]}})})},t.prototype.initWithDb=function(e){return this.db=e,this.storeName=this.db.name,Promise.resolve(this.db)},t.prototype.purge=function(){return this.db?this.db.delete():i.default.delete(this.storeName)},t.prototype.create=function(e,t,r){if(r)return this.db[e].add(r,t).catch(function(r){if(r instanceof i.default.ConstraintError){var n='Record "'+t+'" already exists in "'+e+'". You need to delete the record first if you want to overwrite it.';throw new u.default(n)}throw r});var n='Record "'+t+'" cannot be saved in "'+e+'" because it\'s "undefined" or "null".';return Promise.reject(new c.default(n))},t.prototype.delete=function(e,t){var r=this;return Promise.resolve().then(function(){return r.db[e].delete(t)}).then(function(){return t})},t.prototype.deleteAll=function(e){return this.db[e].clear().then(function(){return!0})},t.prototype.read=function(e,t){return this.db[e].get(t).then(function(r){if(r)return r;var n='Record "'+t+'" in "'+e+'" could not be found.';throw new a.default(n)})},t.prototype.readAll=function(e){return this.db[e].toArray()},t.prototype.readAllPrimaryKeys=function(e){return this.db[e].toCollection().keys()},t.prototype.update=function(e,t,r){return this.db[e].update(t,r).then(function(r){if(0===r){var n='Record "'+t+'" in "'+e+'" could not be found.';throw new a.default(n)}return t})},t.prototype.updateOrCreate=function(e,t,r){return this.db[e].put(r,t)},t.prototype.append=function(e,t,r){var n=this;return this.db[e].get(t).then(function(o){if("string"!=typeof o){var i='Cannot append text to record "'+t+"\" because it's not a string.";throw new c.default(i)}return o+=r,n.updateOrCreate(e,t,o)})},t}();t.default=l}).call(this,r(17))},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{a(n.next(e))}catch(e){i(e)}}function u(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(s,u)}a((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(2),u=r(1),a=function(){function e(){this.storeName=""}return e.prototype.isSupported=function(){return o(this,void 0,void 0,function(){var e;return i(this,function(t){if(!s.isBrowser()||!window.localStorage)throw e="LocalStorage is not available on your platform.",new u.UnsupportedError(e);return[2]})})},e.prototype.init=function(e){return o(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return[4,this.isSupported()];case 1:return t.sent(),this.storeName=e,[2]}})})},e.prototype.purge=function(){return o(this,void 0,void 0,function(){return i(this,function(e){return window.localStorage.clear(),[2]})})},e.prototype.createKey=function(e,t){return this.storeName+"@"+e+"@"+t},e.prototype.create=function(e,t,r){if(r){var n=this.createKey(e,t);return this.read(e,t).catch(function(e){if(!(e instanceof u.RecordNotFoundError))throw e}).then(function(o){if(o){var i='Record "'+t+'" already exists in "'+e+'". You need to delete the record first if you want to overwrite it.';throw new u.RecordAlreadyExistsError(i)}return"string"==typeof o?window.localStorage.setItem(n,String(r)):window.localStorage.setItem(n,JSON.stringify(r)),t})}var o='Record "'+t+'" cannot be saved in "'+e+'" because it\'s "undefined" or "null".';return Promise.reject(new u.RecordTypeError(o))},e.prototype.delete=function(e,t){var r=this;return Promise.resolve().then(function(){var n=r.createKey(e,t);return window.localStorage.removeItem(n),t})},e.prototype.deleteAll=function(e){var t=this;return Promise.resolve().then(function(){return Object.keys(localStorage).forEach(function(r){var n=t.storeName+"@"+e+"@";r.startsWith(n)&&localStorage.removeItem(r)}),!0})},e.prototype.read=function(e,t){var r=this;return Promise.resolve().then(function(){var n=r.storeName+"@"+e+"@"+t,o=window.localStorage.getItem(n);if(o)try{return JSON.parse(o)}catch(e){return o}var i='Record "'+t+'" in "'+e+'" could not be found.';throw new u.RecordNotFoundError(i)})},e.prototype.readAll=function(e){var t=this,r=[];return Object.keys(localStorage).forEach(function(n){var o=t.storeName+"@"+e+"@";if(n.startsWith(o)){var i=n.replace(o,"");r.push(t.read(e,i))}}),Promise.all(r)},e.prototype.readAllPrimaryKeys=function(e){var t=this,r=[];return Object.keys(localStorage).forEach(function(n){var o=t.storeName+"@"+e+"@";n.startsWith(o)&&r.push(n.replace(o,""))}),Promise.resolve(r)},e.prototype.update=function(e,t,r){var o=this;return this.read(e,t).then(function(e){return n({},e,r)}).then(function(r){return o.create(e,t,r).catch(function(n){if(n instanceof u.RecordAlreadyExistsError)return o.delete(e,t).then(function(){return o.create(e,t,r)});throw n})})},e.prototype.updateOrCreate=function(e,t,r){var n=this;return this.update(e,t,r).catch(function(o){if(o instanceof u.RecordNotFoundError)return n.create(e,t,r);throw o}).then(function(){return t})},e.prototype.append=function(e,t,r){var n=this;return this.read(e,t).then(function(o){if("string"!=typeof o){var i='Cannot append text to record "'+t+"\" because it's not a string.";throw new u.RecordTypeError(i)}o+=r;var s=n.createKey(e,t);return window.localStorage.setItem(s,o),t})},e}();t.default=a},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{a(n.next(e))}catch(e){i(e)}}function u(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(s,u)}a((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),u=function(){function e(){this.storeName="",this.stores={}}return e.prototype.isSupported=function(){return o(this,void 0,void 0,function(){return i(this,function(e){return[2]})})},e.prototype.init=function(e){return o(this,void 0,void 0,function(){return i(this,function(t){return this.storeName=e,this.stores[this.storeName]=this.stores[this.storeName]||{},[2]})})},e.prototype.purge=function(){return o(this,void 0,void 0,function(){return i(this,function(e){return delete this.stores[this.storeName],[2]})})},e.prototype.prepareTable=function(e){this.stores[this.storeName][e]||(this.stores[this.storeName][e]={})},e.prototype.create=function(e,t,r){if(r){if(this.prepareTable(e),this.stores[this.storeName][e][t]){var n='Record "'+t+'" already exists in "'+e+'". You need to delete the record first if you want to overwrite it.',o=new s.RecordAlreadyExistsError(n);return Promise.reject(o)}return this.stores[this.storeName][e][t]=r,Promise.resolve(t)}var i='Record "'+t+'" cannot be saved in "'+e+'" because it\'s "undefined" or "null".';return Promise.reject(new s.RecordTypeError(i))},e.prototype.delete=function(e,t){var r=this;return this.prepareTable(e),Promise.resolve().then(function(){return delete r.stores[r.storeName][e][t],t})},e.prototype.deleteAll=function(e){var t=this;return Promise.resolve().then(function(){return delete t.stores[t.storeName][e],!0})},e.prototype.read=function(e,t){this.prepareTable(e);var r=this.stores[this.storeName][e][t];if(r)return Promise.resolve(r);var n='Record "'+t+'" in "'+e+'" could not be found.';return Promise.reject(new s.RecordNotFoundError(n))},e.prototype.readAll=function(e){this.prepareTable(e);for(var t=[],r=0,n=Object.keys(this.stores[this.storeName][e]);r<n.length;r++){var o=n[r];t.push(this.read(e,o))}return Promise.all(t)},e.prototype.readAllPrimaryKeys=function(e){return this.prepareTable(e),Promise.resolve(Object.keys(this.stores[this.storeName][e]))},e.prototype.update=function(e,t,r){var o=this;return this.prepareTable(e),this.read(e,t).then(function(e){return n({},e,r)}).then(function(r){return o.stores[o.storeName][e][t]=r,t})},e.prototype.updateOrCreate=function(e,t,r){var n=this;return this.prepareTable(e),this.update(e,t,r).catch(function(o){if(o instanceof s.RecordNotFoundError)return n.create(e,t,r);throw o}).then(function(){return t})},e.prototype.append=function(e,t,r){var n=this;return this.prepareTable(e),this.read(e,t).then(function(o){if("string"!=typeof o){var i='Cannot append text to record "'+t+"\" because it's not a string.";throw new s.RecordTypeError(i)}return o+=r,n.stores[n.storeName][e][t]=o,t})},e}();t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(21);t.ExpiredBundle=n.default;var o=r(6);t.TransientBundle=o.default;var i=r(22);t.TransientStore=i.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(){this.cacheKey="",this.primaryKey=""}}();t.default=n},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{a(n.next(e))}catch(e){i(e)}}function u(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(s,u)}a((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(23),u=r(1),a=r(6),c=function(e){function t(t){var r=e.call(this)||this;return r.engine=t,r.bundles={},r.tableName="",r}return n(t,e),t.prototype.init=function(e){var t=this;this.tableName=e;var r=[];return this.engine.readAllPrimaryKeys(this.tableName).then(function(e){var n=[];return e.forEach(function(e){var o=t.constructCacheKey(e);r.push(o),n.push(t.engine.read(t.tableName,e))}),Promise.all(n)}).then(function(e){return o(t,void 0,void 0,function(){var t,n,o,s,u,a;return i(this,function(i){switch(i.label){case 0:for(n in t=[],e)t.push(n);o=0,i.label=1;case 1:return o<t.length?(s=t[o],u=e[s],a=r[s],[4,this.startTimer(a)]):[3,4];case 2:i.sent(),this.bundles[a]=u,i.label=3;case 3:return o++,[3,1];case 4:return[2,e]}})})})},t.prototype.constructCacheKey=function(e){return this.engine.storeName+"@"+this.tableName+"@"+e},t.prototype.constructPrimaryKey=function(e){return e.replace(this.engine.storeName+"@"+this.tableName+"@","")},t.prototype.createTransientBundle=function(e,t){return{expires:Date.now()+t,payload:e}},t.prototype.get=function(e){var t=this;return this.getFromCache(e).then(function(r){return void 0!==r?r:t.getFromStore(e)}).catch(function(e){if(!(e instanceof u.RecordNotFoundError))throw e})},t.prototype.getFromCache=function(e){var t=this.bundles[this.constructCacheKey(e)];return Promise.resolve(t)},t.prototype.getFromStore=function(e){return this.engine.read(this.tableName,e)},t.prototype.set=function(e,t,r){var n=this,o=this.createTransientBundle(t,r);return new Promise(function(t,r){return n.getFromCache(e).then(function(i){if(i){var s='Record with primary key "'+e+'" already exists in table "'+n.tableName+'" of database "'+n.engine.storeName+'".';return r(new u.RecordAlreadyExistsError(s))}return n.save(e,o).then(function(e){return Promise.all([e,n.startTimer(e)])}).then(function(e){var r=e[0],o=e[1];t(n.saveInCache(r,o))})})})},t.prototype.save=function(e,t){var r=this.constructCacheKey(e);return Promise.all([this.saveInStore(e,t),this.saveInCache(r,t)]).then(function(){return r})},t.prototype.saveInStore=function(e,t){return this.engine.create(this.tableName,e,t)},t.prototype.saveInCache=function(e,t){return this.bundles[e]=t},t.prototype.delete=function(e){var t=this.constructCacheKey(e);return Promise.all([this.deleteFromStore(e),this.deleteFromCache(t)]).then(function(){return t})},t.prototype.deleteFromStore=function(e){return this.engine.delete(this.tableName,e)},t.prototype.deleteFromCache=function(e){var t=this.bundles[e]&&this.bundles[e].timeoutID;return t&&clearTimeout(t),delete this.bundles[e],e},t.prototype.expireBundle=function(e){var t={cacheKey:e,payload:this.bundles[e].payload,primaryKey:this.constructPrimaryKey(e)};return this.delete(t.primaryKey).then(function(){return t})},t.prototype.startTimer=function(e){var r=this,n=this.constructPrimaryKey(e);return this.get(n).then(function(n){return o(r,void 0,void 0,function(){var r,s,u,c=this;return i(this,function(l){switch(l.label){case 0:return n||((n=new a.default).expires=0,n.payload=void 0),r=n.expires,s=n.timeoutID,u=r-Date.now(),r<=0?[4,this.expireBundle(e)]:[3,2];case 1:return l.sent(),[3,3];case 2:s||(n.timeoutID=setTimeout(function(){return o(c,void 0,void 0,function(){var r;return i(this,function(n){switch(n.label){case 0:return[4,this.expireBundle(e)];case 1:return r=n.sent(),this.emit(t.TOPIC.EXPIRED,r),[2]}})})},u)),l.label=3;case 3:return[2,n]}})})})},t.TOPIC={EXPIRED:"expired"},t}(s.EventEmitter);t.default=c},function(e,t){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function o(e){return"object"==typeof e&&null!==e}function i(e){return void 0===e}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!function(e){return"number"==typeof e}(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,r,s,u,a,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(i(r=this._events[e]))return!1;if(n(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:u=Array.prototype.slice.call(arguments,1),r.apply(this,u)}else if(o(r))for(u=Array.prototype.slice.call(arguments,1),s=(c=r.slice()).length,a=0;a<s;a++)c[a].apply(this,u);return!0},r.prototype.addListener=function(e,t){var s;if(!n(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(s=i(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){if(!n(t))throw TypeError("listener must be a function");var r=!1;function o(){this.removeListener(e,o),r||(r=!0,t.apply(this,arguments))}return o.listener=t,this.on(e,o),this},r.prototype.removeListener=function(e,t){var r,i,s,u;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(s=(r=this._events[e]).length,i=-1,r===t||n(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(r)){for(u=s;u-- >0;)if(r[u]===t||r[u].listener&&r[u].listener===t){i=u;break}if(i<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n(r=this._events[e]))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}}]);
//# sourceMappingURL=store-engine.bundle.js.map