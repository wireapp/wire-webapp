"use strict";(self.webpackChunkwire_webapp=self.webpackChunkwire_webapp||[]).push([[414],{"./src/script/util/DebugUtil.ts":(e,t,s)=>{s.r(t),s.d(t,{DebugUtil:()=>R});s("./node_modules/core-js/modules/es.array.iterator.js"),s("./node_modules/core-js/modules/es.promise.js"),s("./node_modules/core-js/modules/web.dom-collections.iterator.js"),s("./node_modules/core-js/modules/es.typed-array.from.js"),s("./node_modules/core-js/modules/es.typed-array.uint8-array.js"),s("./node_modules/core-js/modules/es.typed-array.fill.js"),s("./node_modules/core-js/modules/es.typed-array.set.js"),s("./node_modules/core-js/modules/es.typed-array.sort.js"),s("./node_modules/core-js/modules/es.typed-array.to-locale-string.js"),s("./node_modules/core-js/modules/es.array.flat-map.js"),s("./node_modules/core-js/modules/es.array.unscopables.flat-map.js"),s("./node_modules/core-js/modules/es.array.includes.js"),s("./node_modules/core-js/modules/es.string.includes.js"),s("./node_modules/core-js/modules/es.parse-int.js"),s("./node_modules/core-js/modules/es.symbol.description.js");var i=s("./node_modules/@wireapp/api-client/lib/connection/index.js"),o=s("./node_modules/@wireapp/api-client/lib/conversation/data/index.js"),r=s("./node_modules/@wireapp/api-client/lib/event/index.js"),n=s("./node_modules/@wireapp/core/lib/notification/NotificationDatabaseRepository.js"),a=s("./node_modules/dexie/dist/modern/dexie.min.mjs"),c=s("./node_modules/tsyringe/dist/esm5/index.js"),l=s("./src/script/util/Logger.ts"),d=s("./src/script/util/util.ts"),u=s("./src/script/calling/CallState.ts"),v=s("./src/script/client/ClientState.ts"),p=s("./src/script/conversation/ConversationState.ts"),g=s("./src/script/event/EventRepository.ts"),m=s("./src/script/lifecycle/newVersionHandler.ts"),y=s("./src/script/message/MessageCategory.ts"),A=s("./src/script/service/CoreSingleton.ts"),h=s("./src/script/storage/index.ts"),C=s("./src/script/user/UserState.ts"),S=s("./node_modules/jquery/dist/jquery.js");function f(e,t,s,i,o,r,n){try{var a=e[r](n),c=a.value}catch(e){return void s(e)}a.done?t(c):Promise.resolve(c).then(i,o)}function I(e){return function(){var t=this,s=arguments;return new Promise((function(i,o){var r=e.apply(t,s);function n(e){f(r,i,o,n,a,"next",e)}function a(e){f(r,i,o,n,a,"throw",e)}n(void 0)}))}}function w(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class R{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c.nC.resolve(v.p),s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.nC.resolve(C.a),i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:c.nC.resolve(p.g),o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:c.nC.resolve(u.O),r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:c.nC.resolve(A.Q);this.clientState=t,this.userState=s,this.conversationState=i,this.callState=o,this.core=r,w(this,"logger",void 0),w(this,"callingRepository",void 0),w(this,"clientRepository",void 0),w(this,"connectionRepository",void 0),w(this,"conversationRepository",void 0),w(this,"eventRepository",void 0),w(this,"storageRepository",void 0),w(this,"messageRepository",void 0),w(this,"$",void 0),w(this,"userRepository",void 0),w(this,"Dexie",void 0),this.$=S,this.Dexie=a.default;const{calling:n,client:d,connection:g,conversation:m,event:y,user:h,storage:f,message:I}=e;this.callingRepository=n,this.clientRepository=d,this.conversationRepository=m,this.connectionRepository=g,this.eventRepository=y,this.storageRepository=f,this.userRepository=h,this.messageRepository=I,this.logger=(0,l.jl)("DebugUtil")}breakLastNotificationId(){return this.storageRepository.storageService.update(h.iM.OBJECT_STORE.AMPLIFY,n.DatabaseKeys.PRIMARY_KEY_LAST_NOTIFICATION,{value:(0,d.nX)(1)})}blockAllConnections(){const e=this.userState.users().map((e=>this.connectionRepository.blockUser(e)));return Promise.all(e)}resetIdentity(){var e=this;return I((function*(){e.core.coreCryptoClient.wipe()}))()}breakSession(e,t){var s=this;return I((function*(){const i=s.core.service.proteus,o="string"==typeof e?{domain:"",id:e}:e,r=i.constructSessionId(o,t);i.coreCryptoClient.proteusSessionFromPrekey(r,Uint8Array.from([165,0,1,1,24,57,2,161,0,88,32,212,202,30,83,242,93,67,164,202,137,214,167,166,183,236,249,32,21,117,247,56,223,135,170,3,151,16,228,165,186,124,208,3,161,0,161,0,88,32,123,200,16,166,184,70,21,81,43,80,21,231,182,142,51,220,131,162,11,255,162,74,78,162,95,156,131,48,203,5,77,122,4,246]))}))()}triggerVersionCheck(e){return(0,m.Ye)(e)}enableLinkPreviews(){window.openGraphAsync=e=>Promise.resolve({description:"an interesting article about the past",image:{data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAACWCAYAAAA8AXHiAAADiUlEQVR4nO3dS67cMAwEwHeWuf8dkxOMDVDTJiVXA1pq+FF5EyDJ3+fz+XfCuUp3bzv3Wj1/3Q288bF26rV6wNJr5ICl18gBS6+RA5ZeIwcsvUbOJaxpSTxW9V5HzWkBC6xIwAIrErDAigQssCIBC6xIwAIrkgisu6VXT7Vm4l5HTnkPsIbllPcAa1hOeQ+whuWU9wBrWE55D7CG5ZT3AGtYTnmP18PqmGOnGas1wQILrGm9ggUWWGDts3SwwAILrH2WDhZYYIH1+6V35JSPp1oTrFDAOmSQaQHrkEGmBaxDBpkWsA4ZZFrAOmSQaQHr5Y+1Mn9id6e8B1hglQMWWJGABVYkYIEVCVhgRQIWWJGUYe10qguo3uuqucsBCyywpj0yWGCBBRZYJxywwAJr2iODdQHrcsoXZNpHcErAAisSsMCKBCywIgELrEjAAisSsMCKpPznWCuZ9Fgrv/k0nmq9jo8HLLDAAgusxwdN9JK8+2SvYIEVqQcWWJF6YIEVqbcVrBSCSXg65u+YI7EDsAJLBQusyFLBAiuyVLDAiiwVLLAiSwULrMhSwbr5yxQdgySG7IA1acaOOcAK1Zs0I1g3AQusbZaeqjdpRrBuAhZY2yw9VW/SjGDdBCywtll6qt6kGY+BdZfU706pt9JP4iPo6AeshoAF1uP9gLUQsMAC6+F+wFoIWGCB9XA/r4CVGqT6u4mz0svTc6SS6BWshV6eniMVsMCKBCywIgELrEjAAisSsMCKZBSsnQLWdRI1wSreA+s6YBXvgXUdsIr3wLoOWMV7YF0HrOI9sK4DVvEeWNd5xX/dW00HrGmp9gpWcalggRVZKlhgRZYKFliRpYIFVmSpYIEVWSpYC7CmJfHI1XsdH0FqjkRNsIr3wAILLLCuAxZYkYAFViRggRUJWC+A1bH0ab0+jWenAxZYYE3rFSywwAKrVnPaY1XTDQKsAb2CBRZYYNVq7vSQiV5XZkzsByywIvsBC6zIfsACK7IfsMCK7AcssCL7AQusyH7AAiuyn9fDSs3YUXPSRwBWaMaOmmCBFakJFliRmmCBFakJFliRmmCBFal5BKyO7PQRJPpJ7Gb17reABRZYYP1+N6t3vwUssMAC6/e7Wb37LWCBBRZYv9/N6t1vecU/btvx8UyCvNJr9R5YoYA1AAVYYI09icWtBKwBKMACa+xJLG4lYA1AAdZ5sP4Df5GjbWdSI2IAAAAASUVORK5CYII="},title:"A link to the past",type:"article",url:e})}isSendingMessage(){return this.core.service.conversation.isSendingMessage()}getLastMessagesFromDatabase(){var e=arguments,t=this;return I((function*(){let s=e.length>0&&void 0!==e[0]?e[0]:10,i=e.length>1&&void 0!==e[1]?e[1]:t.conversationState.activeConversation().id;if(t.storageRepository.storageService.db){return(yield t.storageRepository.storageService.db.events.toArray()).filter((e=>e.conversation===i)).slice(-s).reverse()}return[]}))()}haveISentThisMessageToMyOtherClients(e){var t=arguments,s=this;return I((function*(){let i=t.length>1&&void 0!==t[1]?t[1]:s.conversationState.activeConversation().id;const o=s.clientState.currentClient().id,n=s.userState.self().id,a=yield s.conversationRepository.getConversationById({domain:"",id:i}),c=yield s.messageRepository.getMessageInConversationById(a,e),l=yield s.eventRepository.notificationService.getNotifications(void 0,void 0,g.T.CONFIG.NOTIFICATION_BATCHES.MAX),d=new Date(c.timestamp()),u=l.notifications.flatMap((e=>e.payload)).filter((e=>e.type===r.CONVERSATION_EVENT.OTR_MESSAGE_ADD&&(e=>e.conversation===i)(e)&&(e=>e.from===n&&e.data&&e.data.sender===o)(e)&&((e,t)=>e.time===t.toISOString())(e,d))),v=u.map((e=>e.data.recipient)),p=yield s.clientRepository.getClientsForSelf(),m=p.map((e=>e.id)).filter((e=>v.includes(e))),y=m.length?`Message was sent to all other "${p.length}" clients.`:`Message was NOT sent to the following own clients: ${m.join(",")}`;s.logger.info(y)}))()}getEventInfo(e){var t=this;return I((function*(){const s=yield t.conversationRepository.getConversationById(e.qualified_conversation),i=yield t.userRepository.getUserById(e.qualified_from||{domain:"",id:e.from}),o={conversation:s,event:e,user:i},r=`Hey ${t.userState.self().name()}, this is for you:`;return t.logger.warn(r,o),t.logger.warn(`Conversation: ${o.conversation.name()}`,o.conversation),t.logger.warn(`From: ${o.user.name()}`,o.user),o}))()}getCallingLogs(){return this.callingRepository.callLog.join("\n")}getActiveCallStats(){const e=this.callState.joinedCall();if(!e)throw new Error("no active call found");return this.callingRepository.getStats(e.conversationId)}enableFakeMediaDevices(){const e=[{deviceId:"ff0000",groupId:"fakeCamera1",kind:"videoinput",label:"Red cam"},{deviceId:"00ff00",groupId:"fakeCamera2",kind:"videoinput",label:"Green cam"},{deviceId:"0000ff",groupId:"fakeCamera3",kind:"videoinput",label:"Blue cam"}],t=[{deviceId:"440",groupId:"fakeMic1",kind:"audioinput",label:"First mic"},{deviceId:"100",groupId:"fakeMic2",kind:"audioinput",label:"Second mic"}];navigator.mediaDevices.enumerateDevices=()=>Promise.resolve(e.concat(t)),navigator.mediaDevices.getUserMedia=s=>{const i=s.audio,o=i?function(e){const s={exact:void 0},i=(e.deviceId||s).exact||t[0].deviceId,o=new window.AudioContext,r=o.createOscillator();r.type="sine",r.frequency.value=parseInt(i,10);const n=o.createMediaStreamDestination();return r.connect(n),r.start(0),n.stream.getAudioTracks()}(i):[],r=s.video,n=r?function(t){const s={exact:void 0},i=(t.deviceId||s).exact||e[0].deviceId,o=300,r=240,n=document.createElement("canvas");n.height=r,n.width=o;const a=n.getContext("2d");setInterval((()=>{a.fillStyle=`#${i}`,a.fillRect(0,0,o,r),a.fillStyle="#000",a.fillRect(0,0,10*Math.random(),10*Math.random())}),500);return n.captureStream(25).getVideoTracks()}(r):[];return Promise.resolve(new MediaStream(o.concat(n)))},navigator.mediaDevices.ondevicechange(null)}injectLegalHoldLeaveEvent(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;const s=this.conversationState.activeConversation();let i=[];return e&&i.push(this.userState.self().id),i.push(...s.participating_user_ids()),i=i.slice(0,t),this.eventRepository.handleEvent({event:{category:y.K.NONE,conversation:s.id,data:{reason:o.MemberLeaveReason.LEGAL_HOLD_POLICY_CONFLICT,user_ids:i},from:this.userState.self().id,id:(0,d.nX)(),time:s.getNextIsoDate(),type:r.CONVERSATION_EVENT.MEMBER_LEAVE}},g.T.SOURCE.WEB_SOCKET)}blockUserForLegalHold(e){const t=this.conversationState.activeConversation();return this.eventRepository.handleEvent({event:{connection:{conversation:t.id,from:this.userState.self().id,last_update:t.getNextIsoDate(),message:" ",status:i.ConnectionStatus.MISSING_LEGAL_HOLD_CONSENT,to:e},type:r.USER_EVENT.CONNECTION}},g.T.SOURCE.WEB_SOCKET)}}}}]);
//# sourceMappingURL=414.js.map