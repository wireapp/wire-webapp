{"version":3,"file":"min/414.js","mappings":"yrFAyDO,MAAMA,EAgBXC,YACEC,GAMA,IALiBC,EAAc,UAAH,6CAAGC,EAAAA,GAAAA,QAAkBC,EAAAA,GAChCC,EAAY,UAAH,6CAAGF,EAAAA,GAAAA,QAAkBG,EAAAA,GAC9BC,EAAoB,UAAH,6CAAGJ,EAAAA,GAAAA,QAAkBK,EAAAA,GACtCC,EAAY,UAAH,6CAAGN,EAAAA,GAAAA,QAAkBO,EAAAA,GAC9BC,EAAO,UAAH,6CAAGR,EAAAA,GAAAA,QAAkBS,EAAAA,GAAK,KAJ9BV,YAAAA,EAAW,KACXG,UAAAA,EAAS,KACTE,kBAAAA,EAAiB,KACjBE,UAAAA,EAAS,KACTE,KAAAA,EAAI,4VAErBE,KAAKC,EAAIA,EACTD,KAAKE,MAAQA,EAAAA,QAEb,MAAM,QAACC,EAAO,OAAEC,EAAM,WAAEC,EAAU,aAAEC,EAAY,MAAEC,EAAK,KAAEC,EAAI,QAAEC,EAAO,QAAEC,GAAWtB,EACnFY,KAAKW,kBAAoBR,EACzBH,KAAKY,iBAAmBR,EACxBJ,KAAKa,uBAAyBP,EAC9BN,KAAKc,qBAAuBT,EAC5BL,KAAKe,gBAAkBR,EACvBP,KAAKgB,kBAAoBP,EACzBT,KAAKiB,eAAiBT,EACtBR,KAAKkB,kBAAoBR,EAEzBV,KAAKmB,QAASC,EAAAA,EAAAA,IAAU,YAC1B,CAEAC,0BACE,OAAOrB,KAAKgB,kBAAkBM,eAAeC,OAC3CC,EAAAA,GAAAA,aAAAA,QACAC,EAAAA,aAAAA,8BACA,CAACC,OAAOC,EAAAA,EAAAA,IAAiB,IAE7B,CAGAC,sBACE,MAAMC,EAAa7B,KAAKR,UAAUsC,QAAQC,KAAIC,GAAchC,KAAKc,qBAAqBmB,UAAUD,KAChG,OAAOE,QAAQC,IAAIN,EACrB,CAEMO,gBAA+B,iCACnC,EAAKtC,KAAuB,iBAAEuC,MAAO,GADF,EAErC,CAGMC,aAAaC,EAA8BC,GAAiC,iCAChF,MAAMC,EAAiB,EAAK3C,KAAK4C,QAASC,QACpCC,EAAgC,iBAAXL,EAAsB,CAACM,OAAQ,GAAIC,GAAIP,GAAUA,EACtEQ,EAAYN,EAAeO,mBAAmBJ,EAAaJ,GAOjEC,EAAiC,iBAAEQ,yBAAyBF,EAAWG,WAAWC,KAN/D,CACjB,IAAK,EAAG,EAAG,EAAG,GAAI,GAAI,EAAG,IAAK,EAAG,GAAI,GAAI,IAAK,IAAK,GAAI,GAAI,IAAK,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAC3G,IAAK,GAAI,GAAI,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,EAAG,IAAK,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,GAAI,GAAI,IAC1G,IAAK,GAAI,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,GAAI,GAAI,IAAK,GAAI,IAC5G,IAAK,GAAI,IAAK,EAAG,GAAI,IAAK,EAAG,MAEqE,GAVpB,EAWlF,CAGAC,oBAAoBC,GAClB,OAAOC,EAAAA,EAAAA,IAAaD,EACtB,CAKAE,qBAKEC,OAAOC,eAAiBC,GACfxB,QAAQyB,QAAQ,CACrBC,YAAa,wCACbC,MAAO,CACLC,KACE,8xCAcJC,MAAO,qBACPC,KAAM,UACNN,OAGN,CAGAO,mBACE,OAAOjE,KAAKF,KAAK4C,QAASpC,aAAa2D,kBACzC,CAEMC,8BAGoB,iDAFxBC,EAAS,EAAH,6BAAG,GACTC,EAAiB,EAAH,6BAAG,EAAK1E,kBAAkB2E,qBAAqBvB,GAE7D,GAAI,EAAK9B,kBAAkBM,eAAegD,GAAI,CAG5C,aAFsB,EAAKtD,kBAAkBM,eAAegD,GAAGC,OAAOC,WAC7CC,QAAOlE,GAASA,EAAMD,eAAiB8D,IAChDM,OAAOP,GAAQQ,SACjC,CACA,MAAO,EAAG,GANc,EAO1B,CAEMC,qCACJC,GAEe,iDADfT,EAAyB,EAAH,6BAAG,EAAK1E,kBAAkB2E,qBAAqBvB,GAErE,MAAMN,EAAW,EAAKnD,YAAYyF,gBAAgBhC,GAC5CP,EAAS,EAAK/C,UAAUuF,OAAOjC,GAQ/BxC,QAAqB,EAAKO,uBAAuBmE,oBAAoB,CAACnC,OAAQ,GAAIC,GAAIsB,IACtF1D,QAAgB,EAAKQ,kBAAkB+D,6BAA6B3E,EAAcuE,GAClFK,QAAyB,EAAKnE,gBAAgBoE,oBAAoBC,sBACtEC,OACAA,EACAC,EAAAA,EAAAA,OAAAA,qBAAAA,KAEIC,EAAW,IAAIC,KAAK9E,EAAQ+E,aAC5BC,EAAmDR,EAAiBS,cACvEC,SAASC,GAA+BA,EAAaC,UACrDrB,QAAQlE,GAEQA,EAlB+CyD,OAAS+B,EAAAA,mBAAAA,iBAC1CF,IAAoCA,EAAavF,eAAiB8D,EAkB7F4B,CAAwBzF,IAjBKsF,IACjCA,EAAa1C,OAASZ,GAAUsD,EAAa/B,MAAQ+B,EAAa/B,KAAKmC,SAAWzD,EAiB9E0D,CAA0B3F,IAhBH,EAACsF,EAA8CN,IAC1EM,EAAaM,OAASZ,EAASa,cAgB3BC,CAAqB9F,EAAOgF,KAG5Be,EAAaZ,EAAe3D,KAAIxB,GAASA,EAAMuD,KAAKyC,YACpDC,QAAoB,EAAK5F,iBAAiB6F,oBAE1CC,EADgBF,EAAYzE,KAAI3B,GAAUA,EAAO0C,KAClB2B,QAAO3B,GAAMwD,EAAWK,SAAS7D,KAChE8D,EAAaF,EAAeG,OAC7B,kCAAiCL,EAAYK,mBAC7C,sDAAqDH,EAAeI,KAAK,OAC9E,EAAK3F,OAAO4F,KAAKH,EAAY,GAnCd,EAoCjB,CAEMI,aACJzG,GAC6E,iCAC7E,MAAMD,QAAqB,EAAKO,uBAAuBmE,oBAAoBzE,EAAM0G,wBAC3EzG,QAAa,EAAKS,eAAeiG,YAAY3G,EAAM4G,gBAAkB,CAACtE,OAAQ,GAAIC,GAAIvC,EAAM4C,OAE5FiE,EAAmB,CACvB9G,eACAC,QACAC,QAGIoG,EAAc,OAAM,EAAKpH,UAAUuF,OAAOsC,2BAKhD,OAJA,EAAKlG,OAAOmG,KAAKV,EAAYQ,GAC7B,EAAKjG,OAAOmG,KAAM,iBAAgBF,EAAiB9G,aAAa+G,SAAUD,EAAiB9G,cAC3F,EAAKa,OAAOmG,KAAM,SAAQF,EAAiB5G,KAAK6G,SAAUD,EAAiB5G,MAEpE4G,CAAiB,GAfqD,EAgB/E,CAGAG,iBACE,OAAOvH,KAAKW,kBAA2B,QAAEmG,KAAK,KAChD,CAEAU,qBACE,MAAMC,EAAazH,KAAKJ,UAAU8H,aAClC,IAAKD,EACH,MAAM,IAAIE,MAAM,wBAElB,OAAO3H,KAAKW,kBAAkBiH,SAASH,EAAWrD,eACpD,CAGAyD,yBACE,MAAMC,EAAU,CACd,CAACC,SAAU,SAAUC,QAAS,cAAeC,KAAM,aAAcC,MAAO,WACxE,CAACH,SAAU,SAAUC,QAAS,cAAeC,KAAM,aAAcC,MAAO,aACxE,CAACH,SAAU,SAAUC,QAAS,cAAeC,KAAM,aAAcC,MAAO,aAEpEC,EAAc,CAClB,CAACJ,SAAU,MAAOC,QAAS,WAAYC,KAAM,aAAcC,MAAO,aAClE,CAACH,SAAU,MAAOC,QAAS,WAAYC,KAAM,aAAcC,MAAO,eAEpEE,UAAUC,aAAaC,iBAAmB,IAAMpG,QAAQyB,QAAQmE,EAAQS,OAAOJ,IAE/EC,UAAUC,aAAaG,aAAgBC,IACrC,MAAMC,EAAWD,EAAYE,MACvBA,EAAQD,EAQhB,SAA4BD,GAC1B,MAAMG,EAAqB,CAACC,WAAOxD,GAE7ByD,GADkBL,EAAYV,UAA6Ca,GACtDC,OAAoBV,EAAY,GAAGJ,SACxDgB,EAAU,IAAIvF,OAAOwF,aACrBC,EAAMF,EAAQG,mBACpBD,EAAIjF,KAAO,OACXiF,EAAIE,UAAUzH,MAAQ0H,SAASN,EAAI,IACnC,MAAMO,EAAON,EAAQO,+BAIrB,OAHAL,EAAIM,QAAQF,GACZJ,EAAIO,MAAM,GAEHH,EAAKI,OAAOC,gBACrB,CArB2BC,CAAmBjB,GAAY,GAElDkB,EAAWnB,EAAYoB,MACvBA,EAAQD,EAoBhB,SAA4BnB,GAC1B,MAAMG,EAAqB,CAACC,WAAOxD,GAE7ByE,GADkBrB,EAAYV,UAA6Ca,GACnDC,OAAoBf,EAAQ,GAAGC,SACvDgC,EAAQ,IACRC,EAAS,IACTC,EAASC,SAASC,cAAc,UACtCF,EAAOD,OAASA,EAChBC,EAAOF,MAAQA,EACf,MAAMK,EAAMH,EAAOI,WAAW,MAC9BC,aAAY,KACVF,EAAIG,UAAa,IAAGT,IACpBM,EAAII,SAAS,EAAG,EAAGT,EAAOC,GAC1BI,EAAIG,UAAY,OAChBH,EAAII,SAAS,EAAG,EAAmB,GAAhBC,KAAKC,SAA+B,GAAhBD,KAAKC,SAAc,GACzD,KAGH,OADgBT,EAAeU,cAAc,IAC/BC,gBAChB,CAvC2BC,CAAmBjB,GAAY,GAExD,OAAO1H,QAAQyB,QAAQ,IAAImH,YAAYnC,EAAMJ,OAAOsB,IAAQ,EAuC9DzB,UAAUC,aAAa0C,eAAe,KACxC,CAEAC,4BAAoE,IAA1CC,EAAc,UAAH,8CAAUC,EAAW,UAAH,6CAAGC,IACxD,MAAM7K,EAAeN,KAAKN,kBAAkB2E,qBAC5C,IAAIvC,EAAQ,GAMZ,OALImJ,GACFnJ,EAAMsJ,KAAKpL,KAAKR,UAAUuF,OAAOjC,IAEnChB,EAAMsJ,QAAQ9K,EAAa+K,0BAC3BvJ,EAAQA,EAAM4C,MAAM,EAAGwG,GAChBlL,KAAKe,gBAA6B,YACvC,CACER,MAAO,CACL+K,SAAUC,EAAAA,EAAAA,KACVjL,aAAcA,EAAawC,GAC3BgB,KAAM,CAAC0H,OAAQC,EAAAA,kBAAAA,2BAA8CC,SAAU5J,GACvEqB,KAAMnD,KAAKR,UAAUuF,OAAOjC,GAC5BA,IAAInB,EAAAA,EAAAA,MACJwE,KAAM7F,EAAaqL,iBACnB3H,KAAM+B,EAAAA,mBAAAA,eAGVT,EAAAA,EAAAA,OAAAA,WAEJ,CAEAsG,sBAAsBrJ,GACpB,MAAMjC,EAAeN,KAAKN,kBAAkB2E,qBAC5C,OAAOrE,KAAKe,gBAA6B,YACvC,CACER,MAAO,CACLF,WAAY,CACVC,aAAcA,EAAawC,GAC3BK,KAAMnD,KAAKR,UAAUuF,OAAOjC,GAC5B+I,YAAavL,EAAaqL,iBAC1BjL,QAAS,IACToL,OAAQC,EAAAA,iBAAAA,2BACRC,GAAIzJ,GAENyB,KAAMiI,EAAAA,WAAAA,aAGV3G,EAAAA,EAAAA,OAAAA,WAEJ,E","sources":["webpack://wire-webapp/./src/script/util/DebugUtil.ts"],"sourcesContent":["/*\n * Wire\n * Copyright (C) 2018 Wire Swiss GmbH\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {ConnectionStatus} from '@wireapp/api-client/lib/connection/';\nimport {MemberLeaveReason} from '@wireapp/api-client/lib/conversation/data/';\nimport {\n  BackendEvent,\n  ConversationEvent,\n  ConversationOtrMessageAddEvent,\n  CONVERSATION_EVENT,\n  USER_EVENT,\n} from '@wireapp/api-client/lib/event/';\nimport type {Notification} from '@wireapp/api-client/lib/notification/';\nimport type {QualifiedId} from '@wireapp/api-client/lib/user';\nimport {DatabaseKeys} from '@wireapp/core/lib/notification/NotificationDatabaseRepository';\nimport Dexie from 'dexie';\nimport {container} from 'tsyringe';\n\nimport {getLogger, Logger} from 'Util/Logger';\n\nimport {createRandomUuid} from './util';\n\nimport {CallingRepository} from '../calling/CallingRepository';\nimport {CallState} from '../calling/CallState';\nimport {ClientRepository} from '../client';\nimport {ClientState} from '../client/ClientState';\nimport {ConnectionRepository} from '../connection/ConnectionRepository';\nimport {ConversationRepository} from '../conversation/ConversationRepository';\nimport {ConversationState} from '../conversation/ConversationState';\nimport type {MessageRepository} from '../conversation/MessageRepository';\nimport {Conversation} from '../entity/Conversation';\nimport {User} from '../entity/User';\nimport {EventRepository} from '../event/EventRepository';\nimport {checkVersion} from '../lifecycle/newVersionHandler';\nimport {MessageCategory} from '../message/MessageCategory';\nimport {Core} from '../service/CoreSingleton';\nimport {EventRecord, StorageRepository, StorageSchemata} from '../storage';\nimport {UserRepository} from '../user/UserRepository';\nimport {UserState} from '../user/UserState';\nimport {ViewModelRepositories} from '../view_model/MainViewModel';\n\nexport class DebugUtil {\n  private readonly logger: Logger;\n  private readonly callingRepository: CallingRepository;\n  private readonly clientRepository: ClientRepository;\n  private readonly connectionRepository: ConnectionRepository;\n  /** Used by QA test automation. */\n  public readonly conversationRepository: ConversationRepository;\n  private readonly eventRepository: EventRepository;\n  private readonly storageRepository: StorageRepository;\n  private readonly messageRepository: MessageRepository;\n  public readonly $: JQueryStatic;\n  /** Used by QA test automation. */\n  public readonly userRepository: UserRepository;\n  /** Used by QA test automation. */\n  public readonly Dexie: typeof Dexie;\n\n  constructor(\n    repositories: ViewModelRepositories,\n    private readonly clientState = container.resolve(ClientState),\n    private readonly userState = container.resolve(UserState),\n    private readonly conversationState = container.resolve(ConversationState),\n    private readonly callState = container.resolve(CallState),\n    private readonly core = container.resolve(Core),\n  ) {\n    this.$ = $;\n    this.Dexie = Dexie;\n\n    const {calling, client, connection, conversation, event, user, storage, message} = repositories;\n    this.callingRepository = calling;\n    this.clientRepository = client;\n    this.conversationRepository = conversation;\n    this.connectionRepository = connection;\n    this.eventRepository = event;\n    this.storageRepository = storage;\n    this.userRepository = user;\n    this.messageRepository = message;\n\n    this.logger = getLogger('DebugUtil');\n  }\n\n  breakLastNotificationId() {\n    return this.storageRepository.storageService.update(\n      StorageSchemata.OBJECT_STORE.AMPLIFY,\n      DatabaseKeys.PRIMARY_KEY_LAST_NOTIFICATION,\n      {value: createRandomUuid(1)},\n    );\n  }\n\n  /** Used by QA test automation. */\n  blockAllConnections(): Promise<void[]> {\n    const blockUsers = this.userState.users().map(userEntity => this.connectionRepository.blockUser(userEntity));\n    return Promise.all(blockUsers);\n  }\n\n  async resetIdentity(): Promise<void> {\n    this.core['coreCryptoClient'].wipe();\n  }\n\n  /** Used by QA test automation. */\n  async breakSession(userId: string | QualifiedId, clientId: string): Promise<void> {\n    const proteusService = this.core.service!.proteus;\n    const qualifiedId = typeof userId === 'string' ? {domain: '', id: userId} : userId;\n    const sessionId = proteusService.constructSessionId(qualifiedId, clientId);\n    const fakePrekey = [\n      165, 0, 1, 1, 24, 57, 2, 161, 0, 88, 32, 212, 202, 30, 83, 242, 93, 67, 164, 202, 137, 214, 167, 166, 183, 236,\n      249, 32, 21, 117, 247, 56, 223, 135, 170, 3, 151, 16, 228, 165, 186, 124, 208, 3, 161, 0, 161, 0, 88, 32, 123,\n      200, 16, 166, 184, 70, 21, 81, 43, 80, 21, 231, 182, 142, 51, 220, 131, 162, 11, 255, 162, 74, 78, 162, 95, 156,\n      131, 48, 203, 5, 77, 122, 4, 246,\n    ];\n    proteusService['coreCryptoClient'].proteusSessionFromPrekey(sessionId, Uint8Array.from(fakePrekey));\n  }\n\n  /** Used by QA test automation. */\n  triggerVersionCheck(baseVersion: string): Promise<string | void> {\n    return checkVersion(baseVersion);\n  }\n\n  /**\n   * Used by QA test automation: Will allow the webapp to generate fake link previews when sending a link in a message.\n   */\n  enableLinkPreviews(): void {\n    /*\n     * To allow the LinkPreviewRepository to generate link previews, we need to expose a fake 'openGraphAsync' method.\n     * This function is normally exposed by the desktop wrapper\n     */\n    window.openGraphAsync = url => {\n      return Promise.resolve({\n        description: 'an interesting article about the past',\n        image: {\n          data:\n            'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAACWCAYAAAA8AXHiAAADiUlEQVR4nO3dS67cMAwEwHeWuf8dkxOMDV' +\n            'DTJiVXA1pq+FF5EyDJ3+fz+XfCuUp3bzv3Wj1/3Q288bF26rV6wNJr5ICl18gBS6+RA5ZeIwcsvUbOJaxpSTxW9V5HzWkBC6xIwAIrEr' +\n            'DAigQssCIBC6xIwAIrkgisu6VXT7Vm4l5HTnkPsIbllPcAa1hOeQ+whuWU9wBrWE55D7CG5ZT3AGtYTnmP18PqmGOnGas1wQILrGm9gg' +\n            'UWWGDts3SwwAILrH2WDhZYYIH1+6V35JSPp1oTrFDAOmSQaQHrkEGmBaxDBpkWsA4ZZFrAOmSQaQHr5Y+1Mn9id6e8B1hglQMWWJGABV' +\n            'YkYIEVCVhgRQIWWJGUYe10qguo3uuqucsBCyywpj0yWGCBBRZYJxywwAJr2iODdQHrcsoXZNpHcErAAisSsMCKBCywIgELrEjAAisSsM' +\n            'CKpPznWCuZ9Fgrv/k0nmq9jo8HLLDAAgusxwdN9JK8+2SvYIEVqQcWWJF6YIEVqbcVrBSCSXg65u+YI7EDsAJLBQusyFLBAiuyVLDAii' +\n            'wVLLAiSwULrMhSwbr5yxQdgySG7IA1acaOOcAK1Zs0I1g3AQusbZaeqjdpRrBuAhZY2yw9VW/SjGDdBCywtll6qt6kGY+BdZfU706pt9' +\n            'JP4iPo6AeshoAF1uP9gLUQsMAC6+F+wFoIWGCB9XA/r4CVGqT6u4mz0svTc6SS6BWshV6eniMVsMCKBCywIgELrEjAAisSsMCKZBSsnQ' +\n            'LWdRI1wSreA+s6YBXvgXUdsIr3wLoOWMV7YF0HrOI9sK4DVvEeWNd5xX/dW00HrGmp9gpWcalggRVZKlhgRZYKFliRpYIFVmSpYIEVWS' +\n            'pYC7CmJfHI1XsdH0FqjkRNsIr3wAILLLCuAxZYkYAFViRggRUJWC+A1bH0ab0+jWenAxZYYE3rFSywwAKrVnPaY1XTDQKsAb2CBRZYYN' +\n            'Vq7vSQiV5XZkzsByywIvsBC6zIfsACK7IfsMCK7AcssCL7AQusyH7AAiuyn9fDSs3YUXPSRwBWaMaOmmCBFakJFliRmmCBFakJFliRmm' +\n            'CBFal5BKyO7PQRJPpJ7Gb17reABRZYYP1+N6t3vwUssMAC6/e7Wb37LWCBBRZYv9/N6t1vecU/btvx8UyCvNJr9R5YoYA1AAVYYI09ic' +\n            'WtBKwBKMACa+xJLG4lYA1AAdZ5sP4Df5GjbWdSI2IAAAAASUVORK5CYII=',\n        },\n        title: 'A link to the past',\n        type: 'article',\n        url,\n      });\n    };\n  }\n\n  /** Used by QA test automation. */\n  isSendingMessage(): boolean {\n    return this.core.service!.conversation.isSendingMessage();\n  }\n\n  async getLastMessagesFromDatabase(\n    amount = 10,\n    conversationId = this.conversationState.activeConversation().id,\n  ): Promise<EventRecord[]> {\n    if (this.storageRepository.storageService.db) {\n      const records = await this.storageRepository.storageService.db.events.toArray();\n      const messages = records.filter(event => event.conversation === conversationId);\n      return messages.slice(-amount).reverse();\n    }\n    return [];\n  }\n\n  async haveISentThisMessageToMyOtherClients(\n    messageId: string,\n    conversationId: string = this.conversationState.activeConversation().id,\n  ): Promise<void> {\n    const clientId = this.clientState.currentClient().id;\n    const userId = this.userState.self().id;\n\n    const isOTRMessage = (notification: BackendEvent) => notification.type === CONVERSATION_EVENT.OTR_MESSAGE_ADD;\n    const isInCurrentConversation = (notification: ConversationEvent) => notification.conversation === conversationId;\n    const wasSentByOurCurrentClient = (notification: ConversationOtrMessageAddEvent) =>\n      notification.from === userId && notification.data && notification.data.sender === clientId;\n    const hasExpectedTimestamp = (notification: ConversationOtrMessageAddEvent, dateTime: Date) =>\n      notification.time === dateTime.toISOString();\n    const conversation = await this.conversationRepository.getConversationById({domain: '', id: conversationId});\n    const message = await this.messageRepository.getMessageInConversationById(conversation, messageId);\n    const notificationList = await this.eventRepository.notificationService.getNotifications(\n      undefined,\n      undefined,\n      EventRepository.CONFIG.NOTIFICATION_BATCHES.MAX,\n    );\n    const dateTime = new Date(message.timestamp());\n    const filteredEvents: ConversationOtrMessageAddEvent[] = notificationList.notifications\n      .flatMap((notification: Notification) => notification.payload)\n      .filter((event: ConversationOtrMessageAddEvent) => {\n        return (\n          isOTRMessage(event) &&\n          isInCurrentConversation(event) &&\n          wasSentByOurCurrentClient(event) &&\n          hasExpectedTimestamp(event, dateTime)\n        );\n      }) as ConversationOtrMessageAddEvent[];\n    const recipients = filteredEvents.map(event => event.data.recipient);\n    const selfClients = await this.clientRepository.getClientsForSelf();\n    const selfClientIds = selfClients.map(client => client.id);\n    const missingClients = selfClientIds.filter(id => recipients.includes(id));\n    const logMessage = missingClients.length\n      ? `Message was sent to all other \"${selfClients.length}\" clients.`\n      : `Message was NOT sent to the following own clients: ${missingClients.join(',')}`;\n    this.logger.info(logMessage);\n  }\n\n  async getEventInfo(\n    event: ConversationEvent,\n  ): Promise<{conversation: Conversation; event: ConversationEvent; user: User}> {\n    const conversation = await this.conversationRepository.getConversationById(event.qualified_conversation);\n    const user = await this.userRepository.getUserById(event.qualified_from || {domain: '', id: event.from});\n\n    const debugInformation = {\n      conversation,\n      event,\n      user,\n    };\n\n    const logMessage = `Hey ${this.userState.self().name()}, this is for you:`;\n    this.logger.warn(logMessage, debugInformation);\n    this.logger.warn(`Conversation: ${debugInformation.conversation.name()}`, debugInformation.conversation);\n    this.logger.warn(`From: ${debugInformation.user.name()}`, debugInformation.user);\n\n    return debugInformation;\n  }\n\n  /** Used by QA test automation. */\n  getCallingLogs(): string {\n    return this.callingRepository['callLog'].join('\\n');\n  }\n\n  getActiveCallStats() {\n    const activeCall = this.callState.joinedCall();\n    if (!activeCall) {\n      throw new Error('no active call found');\n    }\n    return this.callingRepository.getStats(activeCall.conversationId);\n  }\n\n  /** Used by QA test automation. */\n  enableFakeMediaDevices(): void {\n    const cameras = [\n      {deviceId: 'ff0000', groupId: 'fakeCamera1', kind: 'videoinput', label: 'Red cam'},\n      {deviceId: '00ff00', groupId: 'fakeCamera2', kind: 'videoinput', label: 'Green cam'},\n      {deviceId: '0000ff', groupId: 'fakeCamera3', kind: 'videoinput', label: 'Blue cam'},\n    ];\n    const microphones = [\n      {deviceId: '440', groupId: 'fakeMic1', kind: 'audioinput', label: 'First mic'},\n      {deviceId: '100', groupId: 'fakeMic2', kind: 'audioinput', label: 'Second mic'},\n    ];\n    navigator.mediaDevices.enumerateDevices = () => Promise.resolve(cameras.concat(microphones) as MediaDeviceInfo[]);\n\n    navigator.mediaDevices.getUserMedia = (constraints: MediaStreamConstraints) => {\n      const audioSet = constraints.audio as MediaTrackConstraintSet;\n      const audio = audioSet ? generateAudioTrack(audioSet) : [];\n\n      const videoSet = constraints.video as MediaTrackConstraintSet;\n      const video = videoSet ? generateVideoTrack(videoSet) : [];\n\n      return Promise.resolve(new MediaStream(audio.concat(video)));\n    };\n\n    function generateAudioTrack(constraints: MediaTrackConstraintSet): MediaStreamTrack[] {\n      const constrainMatchMock = {exact: undefined} as ConstrainDOMStringParameters;\n      const constrainMatch = (constraints.deviceId as ConstrainDOMStringParameters) || constrainMatchMock;\n      const hz = (constrainMatch.exact as string) || microphones[0].deviceId;\n      const context = new window.AudioContext();\n      const osc = context.createOscillator(); // instantiate an oscillator\n      osc.type = 'sine'; // this is the default - also square, sawtooth, triangle\n      osc.frequency.value = parseInt(hz, 10); // Hz\n      const dest = context.createMediaStreamDestination();\n      osc.connect(dest); // connect it to the destination\n      osc.start(0);\n\n      return dest.stream.getAudioTracks();\n    }\n\n    function generateVideoTrack(constraints: MediaTrackConstraintSet): MediaStreamTrack[] {\n      const constrainMatchMock = {exact: undefined} as ConstrainDOMStringParameters;\n      const constrainMatch = (constraints.deviceId as ConstrainDOMStringParameters) || constrainMatchMock;\n      const color = (constrainMatch.exact as string) || cameras[0].deviceId;\n      const width = 300;\n      const height = 240;\n      const canvas = document.createElement('canvas');\n      canvas.height = height;\n      canvas.width = width;\n      const ctx = canvas.getContext('2d');\n      setInterval(() => {\n        ctx.fillStyle = `#${color}`;\n        ctx.fillRect(0, 0, width, height);\n        ctx.fillStyle = '#000';\n        ctx.fillRect(0, 0, Math.random() * 10, Math.random() * 10);\n      }, 500);\n      // Typings missing for: https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/captureStream\n      const stream = (canvas as any).captureStream(25);\n      return stream.getVideoTracks();\n    }\n\n    navigator.mediaDevices.ondevicechange(null);\n  }\n\n  injectLegalHoldLeaveEvent(includeSelf = false, maxUsers = Infinity) {\n    const conversation = this.conversationState.activeConversation();\n    let users = [];\n    if (includeSelf) {\n      users.push(this.userState.self().id);\n    }\n    users.push(...conversation.participating_user_ids());\n    users = users.slice(0, maxUsers);\n    return this.eventRepository['handleEvent'](\n      {\n        event: {\n          category: MessageCategory.NONE,\n          conversation: conversation.id,\n          data: {reason: MemberLeaveReason.LEGAL_HOLD_POLICY_CONFLICT, user_ids: users},\n          from: this.userState.self().id,\n          id: createRandomUuid(),\n          time: conversation.getNextIsoDate(),\n          type: CONVERSATION_EVENT.MEMBER_LEAVE,\n        } as EventRecord,\n      },\n      EventRepository.SOURCE.WEB_SOCKET,\n    );\n  }\n\n  blockUserForLegalHold(userId: string) {\n    const conversation = this.conversationState.activeConversation();\n    return this.eventRepository['handleEvent'](\n      {\n        event: {\n          connection: {\n            conversation: conversation.id,\n            from: this.userState.self().id,\n            last_update: conversation.getNextIsoDate(),\n            message: ' ',\n            status: ConnectionStatus.MISSING_LEGAL_HOLD_CONSENT,\n            to: userId,\n          },\n          type: USER_EVENT.CONNECTION,\n        } as unknown as EventRecord,\n      },\n      EventRepository.SOURCE.WEB_SOCKET,\n    );\n  }\n}\n"],"names":["DebugUtil","constructor","repositories","clientState","container","ClientState","userState","UserState","conversationState","ConversationState","callState","CallState","core","Core","this","$","Dexie","calling","client","connection","conversation","event","user","storage","message","callingRepository","clientRepository","conversationRepository","connectionRepository","eventRepository","storageRepository","userRepository","messageRepository","logger","getLogger","breakLastNotificationId","storageService","update","StorageSchemata","DatabaseKeys","value","createRandomUuid","blockAllConnections","blockUsers","users","map","userEntity","blockUser","Promise","all","resetIdentity","wipe","breakSession","userId","clientId","proteusService","service","proteus","qualifiedId","domain","id","sessionId","constructSessionId","proteusSessionFromPrekey","Uint8Array","from","triggerVersionCheck","baseVersion","checkVersion","enableLinkPreviews","window","openGraphAsync","url","resolve","description","image","data","title","type","isSendingMessage","getLastMessagesFromDatabase","amount","conversationId","activeConversation","db","events","toArray","filter","slice","reverse","haveISentThisMessageToMyOtherClients","messageId","currentClient","self","getConversationById","getMessageInConversationById","notificationList","notificationService","getNotifications","undefined","EventRepository","dateTime","Date","timestamp","filteredEvents","notifications","flatMap","notification","payload","CONVERSATION_EVENT","isInCurrentConversation","sender","wasSentByOurCurrentClient","time","toISOString","hasExpectedTimestamp","recipients","recipient","selfClients","getClientsForSelf","missingClients","includes","logMessage","length","join","info","getEventInfo","qualified_conversation","getUserById","qualified_from","debugInformation","name","warn","getCallingLogs","getActiveCallStats","activeCall","joinedCall","Error","getStats","enableFakeMediaDevices","cameras","deviceId","groupId","kind","label","microphones","navigator","mediaDevices","enumerateDevices","concat","getUserMedia","constraints","audioSet","audio","constrainMatchMock","exact","hz","context","AudioContext","osc","createOscillator","frequency","parseInt","dest","createMediaStreamDestination","connect","start","stream","getAudioTracks","generateAudioTrack","videoSet","video","color","width","height","canvas","document","createElement","ctx","getContext","setInterval","fillStyle","fillRect","Math","random","captureStream","getVideoTracks","generateVideoTrack","MediaStream","ondevicechange","injectLegalHoldLeaveEvent","includeSelf","maxUsers","Infinity","push","participating_user_ids","category","MessageCategory","reason","MemberLeaveReason","user_ids","getNextIsoDate","blockUserForLegalHold","last_update","status","ConnectionStatus","to","USER_EVENT"],"sourceRoot":""}