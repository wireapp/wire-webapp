<div
  id="conversation"
  class="conversation"
  data-bind="css: { loading: !$root.messageList.conversationLoaded() }"
>
  <!-- ko if: $root.conversationRepository.conversationState.activeConversation() -->
  <title-bar
    params="
      contentViewModel: $root,
      mainViewModel: $root.mainViewModel,
      repositories: $root.repositories,
      conversation: $root.conversationState.activeConversation(),
      legalHoldModal: $root.legalHoldModal,
      callActions: $root.mainViewModel.calling.callActions,
      isFederated: $root.mainViewModel.isFederated,
    "
  >
  </title-bar>

  <messages-list
    id="message-list"
    class="message-list"
    data-bind="fadingscrollbar, infinite_scroll: {onHitBottom: () => $root.messageList.loadFollowingMessages(), onHitTop: () => $root.messageList.loadPrecedingMessages()}"
    params="
    conversation: $root.conversationRepository.conversationState.activeConversation,
    conversationRepository: $root.conversationRepository,
    initialMessage: $root.messageList.initialMessage,
    messageRepository: $root.messageRepository,
    selfUser: $root.userState.self,
    showUserDetails: $root.messageList.showUserDetails,
    showImageDetails: $root.messageList.showDetail,
    showMessageDetails: $root.messageList.showMessageDetails,
    showParticipants: $root.messageList.showParticipants,
    cancelConnectionRequest: $root.messageList.clickOnCancelRequest,
    resetSession: $root.messageList.onSessionResetClick,
    invitePeople: $root.messageList.clickOnInvitePeople,
    onClickMessage: $root.messageList.handleClickOnMessage,
    messageActions: $root.messageList.actionsViewModel,
    onLoading: (loading) => $root.messageList.conversationLoaded(!loading),
    getVisibleCallback: $root.messageList.getInViewportCallback,
  "
  ></messages-list>

  <input-bar
    params="
      assetRepository: $root.repositories.asset,
      conversationEntity: $root.conversationState.activeConversation(),
      conversationRepository: $root.repositories.conversation,
      eventRepository: $root.repositories.event,
      messageRepository: $root.repositories.message,
      propertiesRepository: $root.repositories.properties,
      searchRepository: $root.repositories.search,
      storageRepository: $root.repositories.storage,
      teamState: $root.teamState,
      userState: $root.userState,
    ">
  </input-bar>


  <div class="conversation-loading">
    <div class="icon-spinner spin accent-text"></div>
  </div>
  <!-- /ko -->

  <giphy
    id="giphy-modal"
    class="giphy-modal modal modal-large"
    params="giphyRepository: $root.repositories.giphy"
  ></giphy>
</div>
