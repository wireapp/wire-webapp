<div
  id="conversation"
  class="conversation"
  data-bind="css: { loading: !$data.messageList.conversationLoaded() }"
>
  <!-- ko if: $data.conversationRepository.conversationState.activeConversation() -->
  <title-bar
    params="
      conversation: $data.conversationState.activeConversation(),
      legalHoldModal: $data.legalHoldModal,
      panelViewModel: $data.mainViewModel.panel,
      callingRepository: $data.repositories.calling,
      callActions: $data.mainViewModel.calling.callActions,
      panelViewModel: $data.mainViewModel.panel,
    "
  >
  </title-bar>

  <messages-list
    id="message-list"
    class="message-list"
    data-bind="fadingscrollbar, infinite_scroll: {onHitBottom: () => $data.messageList.loadFollowingMessages(), onHitTop: () => $data.messageList.loadPrecedingMessages()}"
    params="
    conversation: $data.conversationRepository.conversationState.activeConversation,
    conversationRepository: $data.conversationRepository,
    initialMessage: $data.messageList.initialMessage,
    messageRepository: $data.messageRepository,
    selfUser: $data.userState.self,
    showUserDetails: $data.messageList.showUserDetails,
    showImageDetails: $data.messageList.showDetail,
    showMessageDetails: $data.messageList.showMessageDetails,
    showParticipants: $data.messageList.showParticipants,
    cancelConnectionRequest: $data.messageList.clickOnCancelRequest,
    resetSession: $data.messageList.onSessionResetClick,
    invitePeople: $data.messageList.clickOnInvitePeople,
    onClickMessage: $data.messageList.handleClickOnMessage,
    messageActions: $data.messageList.actionsViewModel,
    onLoading: (loading) => $data.messageList.conversationLoaded(!loading),
    getVisibleCallback: $data.messageList.getInViewportCallback,
  "
  ></messages-list>

  <input-bar
    params="
      assetRepository: $data.repositories.asset,
      conversationEntity: $data.conversationState.activeConversation(),
      conversationRepository: $data.repositories.conversation,
      eventRepository: $data.repositories.event,
      messageRepository: $data.repositories.message,
      propertiesRepository: $data.repositories.properties,
      searchRepository: $data.repositories.search,
      storageRepository: $data.repositories.storage,
      teamState: $data.teamState,
      userState: $data.userState,
    ">
  </input-bar>


  <div class="conversation-loading">
    <div class="icon-spinner spin accent-text"></div>
  </div>
  <!-- /ko -->

  <giphy
    id="giphy-modal"
    class="giphy-modal modal modal-large"
    params="giphyRepository: $data.repositories.giphy"
  ></giphy>
</div>
