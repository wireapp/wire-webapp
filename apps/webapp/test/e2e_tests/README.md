## Please refer to [Playwright doc](https://playwright.dev/docs/intro) for detailed overview of the framework, troubleshooting, and best practices.

## Requirements beyond the base project

### Prerequisites

Have 1Password's cli installed (op)

Before running tests create the env file by

```
op inject -i apps/webapp/test/e2e_tests/.env.staging.tpl -o apps/webapp/test/e2e_tests/.env
```

It will generate .env file with variables from 1Password

_Note: env. files for other environments (imai, fulu) can be generated by running command above with required template file from the same folder._

### Install dependencies

1. Install JS dependencies: `yarn --immutable`
2. Install Playwright dependencies: `yarn playwright install --with-deps chrome`

_Note: If in doubt, refer to test jobs in [git actions workflows folder](/.github/workflows)._

### Running the Testservice

Some of the E2E tests require a connection to a running [Testservice](https://github.com/wireapp/kalium/tree/develop/tools/testservice). The default address stored in 1Password is for an instance running on prem. If you're within the Wire VPN you can just use it.

If you're not in the Wire VPN you can run it locally as a docker container:

1. Start it by running `docker run -d --platform linux/amd64 -p 8080:8080 -p 8081:8081 quay.io/wire/testservice`
2. Update the env var `TEST_SERVICE_URL` in `test/e2e_tests/.env` to point to it: `TEST_SERVICE_URL=http://localhost:8080``

## Tests

E2E tests can be found inside [test folder](/test/e2e_tests/). The folder contains [page objects](/test/e2e_tests/pageManager), [backend clients (used only for e2e tests)](/test/e2e_tests/backend), [spec files](/test/e2e_tests/specs), [various utils](/test/e2e_tests/utils), and env. template files.

Other important items: [test fixtures](/test/e2e_tests/test.fixtures.ts), [script to create test summary PRs](/test/e2e_tests/scripts/create-playwright-report-summary.ts), and [assets folder (for file exchange tests)](/test/e2e_tests/assets)

CI/CD PR git actions job can be found [here](/.github/workflows/precommit-crit-flows.yml)

[Playwright config can be found in the root folder of the repo](/playwright.config.ts)

### Running the tests

E2E tests can be run via

1. Executing `yarn nx run webapp:e2e` in the root folder of the repo. Running it with `--ui` flag will open Playwright app that can be handy for debugging. Providing `--grep "@{TAG_NAME}"` will result in running only tests with @{TAG_NAME}. For example:

```
yarn nx run webapp:e2e --grep "@regression"
```

You can provide multiple tags with `--grep "@{TAG_NAME1}|@{TAG_NAME2}|@{TAG_NAME3}..."`

2. via VSCode extension in IDE.
